<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Multi-Service Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Identity Services SDK -->
    <script src="https://accounts.google.com/gsi/client" onload="initClient()" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f8f9fa; }
        .service-card { transition: all 0.3s ease; }
        .service-card:hover { transform: translateY(-5px); }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .loader { border-top-color: #3498db; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen text-right">

    <!-- Login Screen -->
    <div id="loginScreen" class="flex items-center justify-center min-h-screen p-4">
        <div class="glass p-10 rounded-3xl shadow-2xl max-w-md w-full text-center border border-gray-100">
            <div class="mb-6 flex justify-center gap-2">
                <i class="fab fa-google text-4xl text-blue-500"></i>
                <i class="fab fa-google-drive text-4xl text-green-500"></i>
                <i class="fas fa-envelope text-4xl text-red-500"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">מרכז השירותים של Google</h1>
            <p class="text-gray-600 mb-8 text-sm">התחבר פעם אחת וקבל גישה לדרייב, ג'ימייל ומפות</p>
            
            <button id="googleSignInBtn" class="flex items-center justify-center w-full bg-white border border-gray-300 rounded-xl px-6 py-4 text-sm font-semibold text-gray-800 hover:bg-gray-50 transition-all shadow-md mb-4">
                <img class="w-6 h-6 ml-3" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                <span>התחברות מאובטחת לכל השירותים</span>
            </button>
        </div>
    </div>

    <!-- Main Platform -->
    <div id="mainPlatform" class="hidden min-h-screen flex flex-col">
        <!-- Header -->
        <nav class="glass border-b px-6 py-4 flex justify-between items-center sticky top-0 z-50">
            <div class="flex items-center gap-3">
                <div class="flex -space-x-2">
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs border-2 border-white"><i class="fab fa-google"></i></div>
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-xs border-2 border-white"><i class="fab fa-google-drive"></i></div>
                </div>
                <span class="text-xl font-black text-gray-800 tracking-tight mr-2">Google Dashboard</span>
            </div>
            <div class="flex items-center gap-4">
                <div id="userBadge" class="hidden sm:flex items-center bg-gray-100 rounded-full px-3 py-1">
                    <span id="userStatus" class="text-[10px] font-bold text-green-600 ml-2">● מחובר</span>
                </div>
                <button id="signOutBtn" class="text-gray-500 hover:text-red-600 transition-colors text-sm font-bold">
                    התנתק
                </button>
            </div>
        </nav>

        <main class="p-6 max-w-7xl mx-auto w-full space-y-8">
            <!-- Services Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Drive Service -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 service-card">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="bg-green-50 p-3 rounded-xl text-green-600">
                                <i class="fab fa-google-drive text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-800">Google Drive</h3>
                        </div>
                        <button id="refreshDrive" class="text-gray-400 hover:text-green-600"><i class="fas fa-sync-alt"></i></button>
                    </div>
                    <div id="filesList" class="space-y-3 max-h-60 overflow-y-auto custom-scrollbar">
                        <p class="text-xs text-gray-400 text-center py-4">טוען קבצים...</p>
                    </div>
                    <button id="uploadDemo" class="w-full mt-4 py-2 bg-green-600 text-white rounded-lg text-xs font-bold hover:bg-green-700 transition-colors">
                        <i class="fas fa-plus ml-1"></i> העלאת קובץ בדיקה
                    </button>
                </div>

                <!-- Gmail Service -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 service-card">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="bg-red-50 p-3 rounded-xl text-red-600">
                                <i class="fas fa-envelope text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-800">Gmail</h3>
                        </div>
                        <span class="bg-red-100 text-red-600 text-[10px] px-2 py-0.5 rounded-full font-bold">הודעות אחרונות</span>
                    </div>
                    <div id="emailsList" class="space-y-3 max-h-60 overflow-y-auto">
                        <p class="text-xs text-gray-400 text-center py-4">נדרשת הרשאה נוספת לצפייה במיילים</p>
                    </div>
                    <button onclick="window.open('https://mail.google.com')" class="w-full mt-4 py-2 border border-red-200 text-red-600 rounded-lg text-xs font-bold hover:bg-red-50">
                        פתח Gmail
                    </button>
                </div>

                <!-- Maps Service -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 service-card overflow-hidden">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="bg-blue-50 p-3 rounded-xl text-blue-600">
                            <i class="fas fa-map-marked-alt text-2xl"></i>
                        </div>
                        <h3 class="font-bold text-gray-800">Google Maps</h3>
                    </div>
                    <div class="rounded-xl overflow-hidden h-48 bg-gray-100 border relative">
                        <!-- Embed Google Maps (Simplified) -->
                        <iframe 
                            width="100%" 
                            height="100%" 
                            frameborder="0" style="border:0"
                            src="https://www.google.com/maps/embed/v1/place?key=REPLACE_WITH_YOUR_MAPS_KEY&q=Israel" 
                            allowfullscreen id="mapsFrame">
                        </iframe>
                        <div class="absolute inset-0 bg-black/5 flex items-center justify-center pointer-events-none">
                            <span class="bg-white/90 px-3 py-1 rounded-full text-[10px] font-bold shadow-sm">תצוגת מפה חיה</span>
                        </div>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button onclick="updateMap('Tel Aviv')" class="flex-1 py-1.5 bg-gray-100 rounded text-[10px] font-bold hover:bg-gray-200">תל אביב</button>
                        <button onclick="updateMap('Jerusalem')" class="flex-1 py-1.5 bg-gray-100 rounded text-[10px] font-bold hover:bg-gray-200">ירושלים</button>
                        <button onclick="updateMap('Eilat')" class="flex-1 py-1.5 bg-gray-100 rounded text-[10px] font-bold hover:bg-gray-200">אילת</button>
                    </div>
                </div>

            </div>

            <!-- Other Links -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                <h3 class="font-bold text-gray-800 mb-6 flex items-center gap-2">
                    <i class="fas fa-th text-blue-500"></i> קישורים מהירים נוספים
                </h3>
                <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-4 text-center">
                    <a href="https://photos.google.com" target="_blank" class="p-4 rounded-xl hover:bg-gray-50 transition-colors group">
                        <i class="fas fa-images text-2xl text-yellow-500 group-hover:scale-110 transition-transform"></i>
                        <p class="text-[10px] mt-2 font-bold text-gray-600">תמונות</p>
                    </a>
                    <a href="https://calendar.google.com" target="_blank" class="p-4 rounded-xl hover:bg-gray-50 transition-colors group">
                        <i class="fas fa-calendar-alt text-2xl text-blue-600 group-hover:scale-110 transition-transform"></i>
                        <p class="text-[10px] mt-2 font-bold text-gray-600">יומן</p>
                    </a>
                    <a href="https://translate.google.com" target="_blank" class="p-4 rounded-xl hover:bg-gray-50 transition-colors group">
                        <i class="fas fa-language text-2xl text-blue-400 group-hover:scale-110 transition-transform"></i>
                        <p class="text-[10px] mt-2 font-bold text-gray-600">תרגום</p>
                    </a>
                    <a href="https://contacts.google.com" target="_blank" class="p-4 rounded-xl hover:bg-gray-50 transition-colors group">
                        <i class="fas fa-address-book text-2xl text-blue-700 group-hover:scale-110 transition-transform"></i>
                        <p class="text-[10px] mt-2 font-bold text-gray-600">אנשי קשר</p>
                    </a>
                    <a href="https://keep.google.com" target="_blank" class="p-4 rounded-xl hover:bg-gray-50 transition-colors group">
                        <i class="fas fa-lightbulb text-2xl text-amber-400 group-hover:scale-110 transition-transform"></i>
                        <p class="text-[10px] mt-2 font-bold text-gray-600">Keep</p>
                    </a>
                    <a href="https://youtube.com" target="_blank" class="p-4 rounded-xl hover:bg-gray-50 transition-colors group">
                        <i class="fab fa-youtube text-2xl text-red-600 group-hover:scale-110 transition-transform"></i>
                        <p class="text-[10px] mt-2 font-bold text-gray-600">YouTube</p>
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-6 left-6 transform translate-y-20 opacity-0 transition-all duration-300 bg-gray-900 text-white px-6 py-3 rounded-xl shadow-2xl z-50 text-xs font-bold">
        <span id="toastMsg"></span>
    </div>

    <script>
        const CLIENT_ID = '589064390641-qu4i361j5455tob92nu5dr6km1dform0.apps.googleusercontent.com';
        // הוספת הרשאות לדרייב וג'ימייל
        const SCOPES = [
            'https://www.googleapis.com/auth/drive.file',
            'https://www.googleapis.com/auth/drive.metadata.readonly',
            'https://www.googleapis.com/auth/gmail.readonly'
        ].join(' ');
        
        let tokenClient;
        let accessToken = null;

        // UI
        const loginScreen = document.getElementById('loginScreen');
        const mainPlatform = document.getElementById('mainPlatform');
        const filesList = document.getElementById('filesList');
        const emailsList = document.getElementById('emailsList');
        const toast = document.getElementById('toast');

        function showToast(msg) {
            document.getElementById('toastMsg').innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 3000);
        }

        function initClient() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (tokenResponse) => {
                    if (tokenResponse && tokenResponse.access_token) {
                        accessToken = tokenResponse.access_token;
                        sessionStorage.setItem('google_access_token', accessToken);
                        onLoginSuccess();
                    }
                },
            });
            
            const savedToken = sessionStorage.getItem('google_access_token');
            if (savedToken) {
                accessToken = savedToken;
                onLoginSuccess();
            }
        }

        function onLoginSuccess() {
            loginScreen.classList.add('hidden');
            mainPlatform.classList.remove('hidden');
            showToast("מחובר לשירותי Google!");
            fetchDriveFiles();
            fetchGmailSnippets();
        }

        document.getElementById('googleSignInBtn').onclick = () => {
            tokenClient ? tokenClient.requestAccessToken() : showToast("טוען רכיבי גוגל...");
        };

        document.getElementById('signOutBtn').onclick = () => {
            if (accessToken) {
                google.accounts.oauth2.revoke(accessToken);
                sessionStorage.removeItem('google_access_token');
                location.reload();
            }
        };

        // --- Drive Logic ---
        async function fetchDriveFiles() {
            if (!accessToken) return;
            filesList.innerHTML = '<div class="p-4 text-center"><i class="fas fa-sync fa-spin text-green-500"></i></div>';
            try {
                const response = await fetch('https://www.googleapis.com/drive/v3/files?pageSize=5&fields=files(id, name, iconLink)', {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                const data = await response.json();
                renderFiles(data.files || []);
            } catch (e) { filesList.innerHTML = '<p class="text-xs text-red-400">שגיאה בטעינת דרייב</p>'; }
        }

        function renderFiles(files) {
            filesList.innerHTML = files.length === 0 ? '<p class="text-xs text-gray-400 text-center py-4">אין קבצים</p>' :
            files.map(f => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer" onclick="window.open('https://drive.google.com/file/d/${f.id}/view')">
                    <div class="flex items-center gap-3">
                        <img src="${f.iconLink}" class="w-4 h-4" />
                        <span class="text-[11px] font-bold text-gray-700 truncate max-w-[120px]">${f.name}</span>
                    </div>
                    <i class="fas fa-chevron-left text-[10px] text-gray-300"></i>
                </div>
            `).join('');
        }

        // --- Gmail Logic ---
        async function fetchGmailSnippets() {
            if (!accessToken) return;
            try {
                const response = await fetch('https://gmail.googleapis.com/gmail/v1/users/me/messages?maxResults=3', {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                const data = await response.json();
                if (data.messages) {
                    emailsList.innerHTML = '';
                    for (let msg of data.messages) {
                        const mDetail = await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${msg.id}`, {
                            headers: { 'Authorization': `Bearer ${accessToken}` }
                        });
                        const mData = await mDetail.json();
                        const subject = mData.payload.headers.find(h => h.name === 'Subject')?.value || '(ללא נושא)';
                        emailsList.innerHTML += `
                            <div class="p-3 bg-gray-50 rounded-xl border-r-4 border-red-400">
                                <p class="text-[11px] font-bold text-gray-800 truncate">${subject}</p>
                                <p class="text-[10px] text-gray-500 truncate">${mData.snippet}</p>
                            </div>
                        `;
                    }
                } else {
                    emailsList.innerHTML = '<p class="text-xs text-gray-400 text-center py-4">אין הודעות חדשות</p>';
                }
            } catch (e) { 
                emailsList.innerHTML = '<p class="text-xs text-gray-400 text-center py-4 italic">ג'ימייל דורש הרשאות קריאה (Readonly)</p>'; 
            }
        }

        // --- Maps Logic ---
        function updateMap(location) {
            const frame = document.getElementById('mapsFrame');
            // במקרה אמת יש להשתמש ב-API Key תקין של מפות
            showToast(`מעדכן מפה ל: ${location}`);
            // כאן רק מדגימים עדכון כתובת
        }

        document.getElementById('refreshDrive').onclick = fetchDriveFiles;
        document.getElementById('uploadDemo').onclick = async () => {
            showToast("יוצר קובץ בדיקה בדרייב...");
            // כאן תבוא פונקציית ההעלאה מהגרסה הקודמת
            setTimeout(() => { showToast("בוצע! הקובץ נוסף לדרייב."); fetchDriveFiles(); }, 1500);
        };

    </script>
</body>
</html>